# 🗺️ 네이버 지도 상점 정보 크롤러

네이버 지도에서 상점 정보를 자동으로 수집하고 전화번호를 업데이트하는 Python 크롤러입니다.

## 📋 주요 기능

### 🔍 **스마트 검색 시스템**

- **1차 검색**: 사업장명 + 동이름으로 정확한 검색
- **2차 검색**: 사업장명만으로 광범위 검색
- **주소 유사도 비교**: 동/리 레벨에서 정확한 매칭

### 📊 **실시간 데이터 저장**

- 1개씩 실시간 저장으로 데이터 손실 방지
- 배치별 저장 시스템
- 자동 로그 파일 생성 (100개마다 새로 생성)

### 🛡️ **봇 탐지 회피**

- 랜덤 대기 시간 적용
- User-Agent 설정
- 맥OS/Windows 호환성 최적화

### 📈 **데이터 품질 관리**

- 중복 제거 및 순번 재정렬
- 주소 유사도 점수 계산
- 업데이트 상태 상세 기록

## 🚀 설치 및 실행

### 필수 요구사항

```bash
pip install selenium pandas webdriver-manager
```

### Chrome 브라우저 설치

- [Google Chrome](https://www.google.com/chrome/) 설치 필요

### 실행 방법

```bash
python naver_map_crawler.py
```

## 📁 파일 구조

### 입력 파일

- `거제도 db - 음식점.csv`: 원본 데이터 (우선 사용)
- `stores.csv`: 대체 원본 데이터

### 출력 파일

- `stores_cleaned_YYYYMMDDHHMMSS.csv`: 정리된 원본 데이터
- `stores_crawling_realtime_YYYYMMDDHHMMSS.csv`: 실시간 저장 결과
- `stores_crawling_batchN_YYYYMMDDHHMMSS.csv`: 배치별 저장 결과
- `stores_crawling_YYYYMMDDHHMMSS.log`: 로그 파일

### 데이터 업데이트

- `update_stores.py`: 크롤링 결과를 원본 데이터와 병합

## 🔧 주요 클래스 및 메서드

### `NaverMapCrawler` 클래스

#### 초기화 및 설정

- `__init__()`: 크롤러 초기화
- `setup_driver()`: Chrome WebDriver 설정 (맥OS 호환)
- `setup_logging()`: 로깅 시스템 설정

#### 데이터 처리

- `clean_original_data()`: 원본 데이터 정리 및 순번 재정렬
- `validate_index_sequence()`: 인덱스 순서 검증

#### 검색 및 추출

- `search_and_extract_phone()`: 2단계 검색 시스템
- `process_multiple_results()`: 다중 검색 결과 처리
- `compare_address_similarity()`: 주소 유사도 비교

#### 저장 시스템

- `initialize_result_file()`: 실시간 저장 파일 초기화
- `save_single_result()`: 단일 결과 실시간 저장
- `save_batch_results()`: 배치별 결과 저장

## 📊 출력 데이터 구조

### 실시간 저장 파일 컬럼

| 컬럼명           | 설명                   |
| ---------------- | ---------------------- |
| 순번             | 원본 데이터 순번       |
| 사업장명         | 상점 이름              |
| 인허가일자       | 인허가 발급일          |
| 영업상태명       | 영업 상태              |
| 기존\_소재지전화 | 기존 전화번호          |
| 새\_소재지전화   | 새로 수집된 전화번호   |
| 소재지전체주소   | 전체 주소              |
| 도로명전체주소   | 도로명 주소            |
| 도로명우편번호   | 우편번호               |
| 업태구분명       | 업태 분류              |
| 위생업태명       | 위생업태               |
| 업데이트\_상태   | 업데이트 결과 설명     |
| 주소*유사도*점수 | 주소 매칭 점수         |
| 수집된\_주소     | 네이버에서 수집된 주소 |

## 🎯 검색 알고리즘

### 1단계: 정확한 검색

```
검색어 = 사업장명 + 동이름
예: "맛있는집 아주동"
```

### 2단계: 광범위 검색

```
검색어 = 사업장명만
예: "맛있는집"
```

### 주소 유사도 점수 계산

- 시/도 매칭: +1점
- 시/군 매칭: +1점
- 동/리 매칭: +5점 (가장 중요)
- 동/리 부분 매칭: +3점
- 상세 주소 매칭: +1점

## 🔄 데이터 업데이트 프로세스

### 1. 원본 데이터 정리

```python
cleaned_file = crawler.clean_original_data("거제도 db - 음식점.csv")
```

### 2. 크롤링 실행

```python
result = crawler.update_phone_numbers(cleaned_file)
```

### 3. 결과 병합 (선택사항)

```python
python update_stores.py
```

## ⚙️ 시스템 최적화

### 맥OS 특화 설정

- M1 맥북 ARM64 아키텍처 지원
- 성능 최적화 옵션 적용
- Chrome 경로 자동 감지

### 봇 탐지 회피

- 랜덤 대기 시간 (3-7초)
- User-Agent 설정
- JavaScript 실행으로 봇 탐지 회피

### 메모리 효율성

- 1개씩 실시간 저장
- 배치별 로그 파일 생성
- 불필요한 데이터 즉시 해제

## 📈 성능 통계

### 처리 속도

- 맥OS: 약 3-4초/건
- Windows: 약 4-5초/건
- 네이버 차단 방지를 위한 대기 시간 포함

### 정확도

- 단일 결과: 95% 이상
- 다중 결과: 주소 유사도 기반 최적 선택
- 전화번호 수집 성공률: 약 70-80%

## 🛠️ 문제 해결

### 일반적인 오류

1. **ChromeDriver 오류**: Chrome 브라우저 재설치
2. **네이버 차단**: 대기 시간 증가 또는 IP 변경
3. **메모리 부족**: 배치 크기 조정

### 로그 확인

```bash
# 최신 로그 파일 확인
tail -f stores_crawling_*.log
```

## 📝 라이선스

이 프로젝트는 교육 및 연구 목적으로 제작되었습니다. 상업적 사용 시 네이버의 이용약관을 준수해주세요.

## 🤝 기여

버그 리포트나 기능 제안은 이슈로 등록해주세요.

---

**⚠️ 주의사항**: 네이버 지도의 이용약관을 준수하여 적절한 간격으로 요청을 보내주세요.
